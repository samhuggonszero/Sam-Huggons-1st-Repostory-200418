SELECT * FROM usage.mendeley.aa_acquisition_poc LIMIT 100;

% of reg in AA?
Changes in aqusition by things in tableau
join to profiles

MAU/traffic

select month, 
case when user_entitling_id_v29 is null then 0 else 1 end as profiel_id_present_user,
referrer_type, 
referring_domains, 
count(distinct(visitor_id)) as visitor_id_count,
count(distinct(user_entitling_id_v29)) as user_entitling_id_v29

from mendeley.aa_acquisition_poc a
left join mendeley.profiles b
on a.user_entitling_id_v29=b.uu_profile_id
group by 1,2,3,4




select month, 
case when user_entitling_id_v29 is null then 0 else 1 end as profiel_id_present_user,
count(distinct(visitor_id)) as visitor_id_count,
count(distinct(user_entitling_id_v29)) as user_entitling_id_v29,
count(distinct(uu_profile_id)) as reg_in_profile

from mendeley.profiles  a
left join mendeley.aa_acquisition_poc b
on b.user_entitling_id_v29=a.uu_profile_id
where month='2017-10-01'
and date_trunc('month',joined)='2017-10-01'
group by 1,2

select month, 
case when user_entitling_id_v29 is null then 0 else 1 end as profiel_id_present_user,
count(distinct(visitor_id)) as visitor_id_count,
count(distinct(user_entitling_id_v29)) as user_entitling_id_v29

from mendeley.aa_acquisition_poc b
where month='2017-10-01'
group by 1,2

266395 acqusiition in Oct 17
210665
79.1% in AA



select visitor_id, count(distinct(user_entitling_id_v29)) from mendeley.aa_acquisition_poc group by 1 having count(distinct(user_entitling_id_v29))>1


select a.*,
case when user_entitling_id_v29 like '%md:%' then substring(user_entitling_id_v29,4,100) else user_entitling_id_v29 end as profile_id
from mendeley.aa_acquisition_poc a
where user_entitling_id_v29 like '%md:%' limit 100


'57ee2cff-e0f0-396a-aeb2-959d847663f1'


select *

from (select a.*,
case when user_entitling_id_v29 like '%md:%' then substring(user_entitling_id_v29,4,100) else user_entitling_id_v29 end as profile_id
from mendeley.aa_acquisition_poc a) b
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
limit 100


select * from mendeley.aa_datafeed_mendeley where post_page_url like '%dgcid%'limit 100

select * from mendeley.aa_datafeed_mendeley limit 100 

'https://www.mendeley.com/community/dgcid'
'https://www.mendeley.com/suggest/raven/feedback%3FpageLoadId%253D6087c1f6-f12f-4907-8552-ca81948c1988%2526ref%253Draven%2526dgcid%253Draven_md_suggest_email%2526event_id%253D72057594202766236%26source%3Dgmail%26ust%3D1504250115058000%26usg%3DAFQjCNHxpyxAg'

post_page_url, 
'https://www.mendeley.com/download-mendeley-desktop/mac/instructions'





select * from mendeley.profile_folder where folder like '%koning%'

'sophie-de-koning'
'sophie-de-koning2'
'9cc22e6d-7d7e-336f-84b5-dbc73732f7f6'




--------------new data is loaded 091117
select * from  mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 limit 10;
select * from  mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 where registrations_e2_event2 =1 limit 10;

select *

from (select a.*,
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a) b
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
limit 100

'October 25, 2017'




---correcting for EST issue
select *

from (select a.*,
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a) b
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-25 19:00:00' and joined<'2017-10-26 19:00:00'
and date='October 26, 2017'
and registrations_e2_event2=0



select registrations_e2_event2,
count(distinct(b.profile_id)) as users

from (select a.*,
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a) b
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-25 19:00:00' and joined<'2017-10-26 19:00:00'
and date='October 26, 2017'
group by 1

---all user entitling ID's balnk at point user registers and register =1 :(
select a.*,
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
where registrations_e2_event2=1


-----
select count(*) from (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)


----checking one guy '1466098272365619869_5725745791659311571'

select * from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31
where visitor_id ='1466098272365619869_5725745791659311571'


with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select *
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'



---checking summary umbers
with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select registrations_e2_event2,
count(distinct(b.profile_id)) as users

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
group by 1

---checking summary umbers
with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
count(distinct(b.profile_id)) as users

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	




select count(distinct(uu_profile_id))
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'




----find profiel id's registered on profile and not in data
select uu_profile_id
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and uu_profile_id not in (with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
b.profile_id

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	
)


----find profile id's registered on profile and not in data
select *
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and uu_profile_id not in (with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
b.profile_id

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	
)


----Hyposthesis for 54.7%  gap on profile ID basis
1) partially down to matching process
2) partialy down to not capturing reg in AA
3) some people reg more than once per visitor ID or profile ID not sure how
4) 


----- investigate
Evaluate data time period
Look at paths of individual users who are not appearing in AA correctly to see what % are join import guys
Look at tracking codes for these users to see if itâ€™s campaign specific

---partial extract for those we know are missing
select * from mendeley.aa_datafeed_mendeley
where mcvisid in ('46209311740920516521249984945059152823','45918920879674687933903812982512644953','78061329739776384904994920302233264986','74197409406747077224985905624874829776','84006353742810211319158581137053241944','40432777475988781465375066069343684042','35181831130459585951555917071979688816','62569773615990001883265304795202090243','3034384848034057882523866799106818707','41250965809486763822191103964085720957','27848204030036797354002328837979141702','749350109921972351174354707517050721','53215958349796990192974122780036569372','34321615376762066218993910290674654451','72291399340373783494808769361630782941','62450770573964665107716121043487624631','13832767976511128225965713448173327007','6728409268376827341976978187382967483','71545495467384402483739677098811052844','64748202819078715468137898457401465299','40727266106662921207279060669586736549','73996917116639286253516152760658620161','41780060753875292474251774169441398641','58845808097598766416028582057993647743','6156754941569287565116514752684974562','13138338953330309414489851184327479906','78258465565097372311044406375550452928','58855982886716109562743945631230084696','48220708662057944646405469568368337461','2256521092910422978988893091279165558','81936844828202403619011035906331127309','86551245334058320215622039000602848569','31650518718468059156917530612484030633','4788879571232555490704922468121818465','86554046320695004101114310486232922027','87590412065000931415007694411605815769','916908423325446924698665239255107611','76502389113250775286225688737118212873','4521151207873805615295719971415744405','54228427925223317585898487959570049895','49806346109341150312604181180507476622','7254809735239835423860530026874574020','39905526256248548785173311059873171113','17648510903166116545123238371885887848','31845515967500831854611687154983699495','37451692339728795361333400723834708041','493940256178355411786149158334703375','7898157458901194226220613066014519241','36317652598253913748701133194198637687','44323584511528674447248994375086323442','3204405584008339786234777396358943242','81761474113778067167160004059987746464','58842456940878651884544880795777916204','345527939933472310516682945252035143','87972785411764661738264525291182192190','12185540239037619422605855558114650855','51403176988204206055226546603826180121','30685433662082079518328837551906184705','28517694983047344799188765753724293476','649545732562974930213599653438049685','22114006550769710614441914470180562770','88886010086367476503084585941494702162','62638399014039044621796037901515723941','87522117253930781063270261138259359069','9656815234485012923007625108819923065','37770480887836155737571204893210294016','30987399470016935876659898365191270988','28214512338116776861100203780924515928','4882850755421868348798395620590200129','45335831122066800144232253257174356976','78775292682310107469151230526316308788','9091207638433989953802356230547778646','31742757118150766333954492215856058123','60936126318030502277743752335005101542','31275361340329611231046232321397753143','17765218391887219745274774399359519802','35067488116504940766991912952240324300','6894140296423367736258097963685413450','70498899308728071549073853373325399095','948835865429315767703139156909572125','78359210900148940784638362124782817317','87696206495220502273269325742851994875','4248797590780834069620000130086184547','50847836364217570074206151328864672922','67480671237684754661837217841432168054','57056555724687190412810345773383312322','6622149907685228464135024559341253436','14614978841999193183895749509023754967','91886871416412112298233683980052437579','66035465805310439032385896813749538958','69103960928403354873141894918841537591','1126209115513779738807623692232458554','7367707181243844468127033201731566246','14477838659148440921515142469492818038','504209114916900984467475058870355937','36258859314669829112881776648166701527','78810420394546916206842068256816103780','7043128581771969845928598838177984231','565564121185015731171397840184937579','13524924882482575921772161982860730427','3482703916416590041187127473221856104','49475444232381605722329984609451839629','12273632055866400046534130708657556618','31998232849762116086917530184599033124','161933830531733425390954190288172845','3362447773673520506461415875853525774','33803336313345368387506339920648416309','84561386842095171811098694290890896066','46197910330343263021907669097428826037','6502639764790863001450134977021270329','69720491817740748496746213135960249345','11372876277191483476374233063604017511','56607274925345138171230260756528816731','16716005743848388743996481576475182905','63071011141106536157523537867297997695','84534071154971285335530864712428937357','21752688820797505111337193624966753236','11168036975878504948911811580211203741','30824402310544388458218027565938866259','23745888155904028735636655923477820882','57582756347273286302314838083339847598','74219695982348356532120540913162846759','35373477504540749353009597572640010079','32906606217629147026907089648780750372','59754404575801010951460683273782200160','1574468508490767402522418758756295075','41011422396660454162912231676879937656','75390894349945919914579809691722961510','28845166115236910958316500170106177418','22998802597641055322033634775502786480','41438235361980048952455184523367127685','2871687503402107202963746044364893751','63507987416877354715502403281650435882','1237561130541804748438718799707534655','88348535711937181854271002933712571957','35522872280304954702439517091466268983','78412571922654350257909181729968916200','85729792895945665674452398274858021837','3374067542866142884540037035554212747','82457632522382980675462621401527327642','60241667830281277156920323825351205495','77778908963374423117541231623248571801','42933210445405086834248908058746365370','957286933079364023961426944413502004','51213536612309406411835331554831835304','34288675038224991764051180305298796140','23623873634116091988718289081994680500','48158911952758597144903963134636497258','66724857957173258776379883584192044329','34157330437050271606454135789776188043','23513586030273641951084569588208397873','4318121507054938338634642310982395295','72523641224816179968490187699586406971','72605032331180688247798303566669937171','83143837019332915369077783968726213190','20813288278125577334640886679450886586','16343898117834973316787540160690763299','15400957528301715305174355418652213218','2932668832536874233006353488233031866','50988706500493919265316728678864377154','9034583814048905367154066713845185332','29384945962838819742865955690110101205','59085916903653279653044472566069182818','23054549358647246486701715054615307343','49692778544361021418332107048615562038','22080699453257221362120108469616495247','27166775089716939872946560291013977992','58631300767966236255566640530408375122','33218844709003263592257173147469247940','7559079019102578378830530854873855827','3729017312977542837544056512556020678','85750428926768079515443628227761818310','30828054596156207237152954586271034825','7762426790118615630562910465424228247','34118583118330561073822809564930490303','23745105040526258456075196516476677271','30613603949961242021791479571589626302','1369533709942638355943403465263599542','704502284529562699115253217018673401','6992755083587941787153306282495036803','83428509808041294805455588267155645963','36111747590535178062410059896783997961','72614624184160917452065616603114192698','46008585197936033863680656242985399071','71351668468822623489105590333502490726','8478612474184237983492538785297033355','8010040007969031005269829563783823958','4179843508267437822848265296840202087','83462525858399280252975429369157645493','6132522627558440547414001899235867730','52065481432115110751946912959638174366','2643836147129594231190858165973268215','48251238166156919711670618326185288687','29311082164830492914613099988150897031','39822635144596755245330157904125221614','87086141835313290443626885447263398878','41117485079441066498279964825037214400','31956308321094894694611686848429893943','19263718422858575967022765259608381453','12049660069351568838611129122741554727','77059651284994936218102597783264759614','49669630867856855915989002444344370748','69611322389720008251668730747811574234','37095621854842546857860060426293039916','53122251870893607337563820293520175887','21556064277158687875429563925351227571','32473996021614128392474276226688065018','26033815422537924603625553930534914583','23184846435493615232655613357185027854','33518444398835670348252915440167340626','71994573204258521117936056844960421660','70830296253945536581721871800629687675','50417035162808763378219506987012481281','117335528372796668175200941496689910','30766759234673459893023541610551829050','42545427048063595972977485502688987014','11125221799858592661772737457454503237','2836953246936432898745458684485061239','76242427944308881885904299921481082461','45671403440903970242237909602779484822','9075541082612210597931815290416583102','2250975448897448920577179591423400767','1258643199780461554313950566088175831','51174074691521232846162477033571681479','90914667328371928325580781835167808140','62438802362479986001615143432711297237','8675664966369347602709905291831752344','3352273299779966455924425759065709902','78061818940454629598809237677693546688','76471557647067003331300987581918300343','9319772011813912336761709116019233630','46379954360290178165011471575702332995','36118485743077428944234477501172405587','92018738411376581807984969279950589416','69498059240132238012018886319085642742','46538658687267854216232958858972575076','1918714359783877218309380445687673743','20683227220384085172132800066817923365','81449536651210605668682340360913264725','42563250667091538333627757805285628399','85746163601142093884959834279072549374','18797718725533496274567760709282966351','28477790156623087363162889661945346260','57496601698105315492096773555264144646','78489208043834107206694822688650288745','57727752696650153671382967856430674296','86687053912474023287193109982430273299','51266819430612630678227466410710152997','84934996207250318585278773723173310357','92010298113969691097672446950447297707','64120129988731688664924686986045184660','53913646938521144987394497743567872820','42578343535927334552991017347222235856','2619365656132502887454431214958084697','3526332219661909974356618491402823728','65059999037218539388141400954329299035','14410557348164226404035036786510490647','59896938704201881494034190253154777532','91818270724445538723111773564763090260','44900911401800977727197339183780318521','68632480549377927851424950978490400764','65425571106663517227361706283492392332','75505116718622367914594272733609671785','74410795781670484043280056242704093432','10331724323988713074823323468659882349','24887867050304678604883293311708036728','80479749582653895985338574221291637574','18228063765066603384513864454536021668','2073797106518074167319802182710612759','17585310936519031883943317974102581693','31279078936529481123189433115382123248','13476681047250742031623275907894174945','1076035063495104236656855964584671653','85534754733564726403622333165762932826','3454130151873423215957262935137975162','61971439945238035885566256600892682868','31314613363498812806917530437464178340','66685678670328245853420187432663227007','82806605998153134564550940877893356396','40065303091431373864550907027043395081','63041239637787481352780138733228628714','14627115267193107295134606941326421672','36991563867389390036572377450604357871','45966052025188101202528117633259822320','23935821319177981008599229746188116056','58221439994723878904001442722878536672','27164074431133006285246888298642651085','60723567577101117164616095201474668697','25862305741468302654877604139732937674','84342956842949731411113607084332234321','62677720279427871654852479414797746639','3486349679563323757947473907176226565','522448057978361037330890512953912442','25046941850979013186518336039618092681','85704956291853096386940459223135750223','46390659717124570032305679029288307451','35040278003212840134448333223060610753','494517980362959664992731726709726049','30819448761842123912510772895013805646','83436112516646086106686942210349748019','31820624355703224456917530145943203734','58200917059742926094725560824239513892','1203966879831858315711097185847143918','24667666820262488668182924212234821412','64944543800172610788463356455153212357','91062806744464326583387014212091853006','331049807019966803297919128514370240','52040969832005800317397868461787042901','8365012051479857741725423406770832561','39775798651315118028825711859114994641','1523193531326399424342348003663844907','35453942462735046123659327636738025095','63545518015522571436337807469582912182','56843479069918469536702826853102347542','62311503987774319483545770372408043278','63258551808896706532036756729642035377','18977683958111927665249935414837855162','12093414949433160202139682835153959220','34336076492069285432600219080103380652','6012657646575864515767679235543676436','75541924400546052007822273351085168181','9504571382843251467269089630558930848','5823931797210782883815516444924932075','4162139001962611587732344945677456247','72077751362037884264059117030408519805','32121532276996943194611687143171949902','18079558119755826653571425870289923664','82796651805347787112483929542547571589','21251786021780320008142669678908148193','46660265911415073629198524254182273431','46921992629255031935035243052383203906','52709666539780870467937648705212202588','62585241119163414878218686669744224205','18169692319063344634591844166290469335','540087905620590207111795863749005712','36094015458826738096753115465349093141','69485974358538597524602470430166478862','31762679598951354456917530339216918673','28951233821079711533961163029522682639','55896380064092344713108225310514386822','19813358769302036844633730400028722911','85292622829041771241693869634290380447','14041512847275532072997972311774690155','61167098086724350117705040090749655432','20793907825028527694489794083474977955','4816496369225125464280470841187240637','77116598635253905061759141847859946272','73421142562057275402132952444250535746','48553733931025923989160903017316292096','76702103824721991514682411441533978369','33776423510287529251822648642330460411','81079297394673130574358013380689196528','775679745394726714267952894581567660','42114321178676865815763059857460703563','53190875798791771996904767259648187217','59221218503907667277077355374708787677','40363284432123175593704127296428950991','58752255918335529665715902977810135075','35670119628168336537693722264954018068','50929730591350752107246909164716045898','45218363271641631177997643690120311927','7400732131291470133955845783418920560','69784603487905612458269071036218118309','84335552768365421303899583090188651437','5137091573597963308277418323896908498','43344262586144637466626795361461260230','18998438779602261447557119495599077715','22078063351751036882046356479922617708','10886149924949852768197580376337461992','10163258060567486494926000835486659753','13427018906684194948764558955532698860','45632394208644201134647108799584882781','34139397905478464298493517126015682850','28559678357618999786071788696265485493','25528634514344760973354361406389568741','45213021010161988826384526843933399931','34135869867986176023676433307915847715','85833279162164043292942457753817701149','14210017433801424858635759716248075356','5855098935844314835617571297322216583','63187331976478891981051593817530232467','9097796555855064711833600102007620674','48066882119340385304953303239206500297','26776556647295538831214194000375717718','13824164367140259486793296410185840640','9191497453990161226530166316897678502','8760959150250259536935381203243048335','75352035190301927124136024356102213269','43672665396117192497931158445749137079','37177511220055339766256668122235210406','31845198577571983544931143917060346275','3265976805673134768734057244305431184','8087527916014134103302465141163302325','4116151469299146235612641510000815931','4449287508222704964838327417435875969','80722528951749137322508297184932963150','5125768451823805018477062892089476884','23704932586732207789041488849624030640','41107960162702615752487135623196660184','30833995592411567194611687184511179285','14939112500573533923793471347455767879','60479615688226712824039835700775573412','59864106740207090157314657399780476423','91892537393319356955718362203353182385','90113002093827808278179262790760190404','51447646930400593778080034563278710663','47102177420574547734710464351345501421','73557288275529587142168912615179891784','5699720489697707057511280566024502136','201126634648356483047905740134766424','10784780768600872151899592379846386691','10900512798210097472969620692440925308','45364288184275513692384855782290920903','64179131635307312391607700484742477817','76842416497789690963286379709568482915','11219181791286862598890607363658406964','5063747925460410882331651732108085173','75474628222965075654944483099788888204','7215414982609140035496284004869404853','2798800676520646904532015801717003851','58858822273428983897364454227739827331','68464413956685427735298168241308708065','86293656649632485985114754760544875101','1012772985667045729155867655189324715','37155204768599149387397862546461101779','38559293053751989941758976964056435911','25475220370939397946775555452741133351','78492029153721924921975345077354504577','645800307787513045535760398011906860','79034478153598478286809510966886519794','71927901000913011117693204104576254358','78824731857755133021452814844691037248','48229993346778289413715323885175280586','11824892983909250563620976790259931098','13884612076559563731706517739004651690','13921000886276673762751454966941397098','57760385284601117523411751065853935238','37868946143758622043699508069523776401','73165257457397569571824766700198993623','42474887839812864805313244743940468439','80032291255850571186012890139138915654','4907416744394224948710947779573305693','106934736184432871020259224295748032','32130309278889446926917530163123062842','37102996610738200774172167713934484744','31431418904707214797997561821788973625','8543622122345620628236742348397690365','87722505375546156967251593439733439777','16620693998734821187032170981806665740','15552592640005497949072583751191220451','54402626161968587073630632294496263519','36026790105645937443515802008179046930','61258674694943470328207302516243586007','42385064961004053324100451422379965832','36252575434083630996192863938883547909','36120217843895489472489496556786103714','2383103716872003596729149951729652682','8661651969957442294289454966557346389','2292590372487498246453244506237871568','8342620856969931010891499617659219513','66615034505408891123586852253850098039','21893065138459754258871280869832619217','59700119398162019542188355296258178552','52300597028486555813654537451579259372','42055915650419639421922400490720206072','79079778809267608605507091584041201594','71547743685284281134580700251034691807','14216174090984038735057116995955196702','20740528308928194727419228353663241304','76380430621249703505951440841818483280','86535416686075920457371867299149333086','6119267247248468261722678370418200606','7167503356398785108393354406555119112','42615145683043357025577578153866460745','45126777927306287311187864957357141322','44559926269034861586583719253392112820','11423213300526327242771163594882350728','27427375968493325824339024830508188854','5425126471538975881910464443309439558','68081967208333472037242259253893531663','20092430100053585034604065433797965636','12782758468280698014686749122645492903','80629218922786680453108231236904956346','4432990572245177203890007583830484502','77301986076279824977039208693511972204','38757819339231605273965084877545126753','76565225644216375638981456346706150129','37196452564662930375479322590810629280','77384509697704221147544761789750715771','11391888139611468635410913418090177944','85316101096080280364072177695662482393','15531039945444317149127027142632028611','62508791719911774324570444975852403206','21783292893271653075046527929141648976','20408329906661713486586488563009176178','88493853403647783262731902539860196814','7785913653794886026974447049556332257','78239423485617707294584645192581284129','57605942510045108883570194889917352982','555599973716035681768449596489884398','62658079547330591832185021346772830609','87013014397055714784636976898437010946','62983386381011281455885810633396659345','20850068508832477024446351321971687393','90035905546398546851133386672091064043','21780986262184771288867487468358030089','61179972459107009754174118065245615900','11585551442240834391143029554615785547','10327522352997156551784698539263849536','76067544543771493088178677225995238091','53536878094098622714541323098215145471','12775935491988324621554189675202814816','80829186442423161787382500798237520615','59240093188389937472276491070982792069','8850576658209132548636750970374048185','2068640936881472574839725953481474681','57683462794781678068800493626478544746','15902045919381046032860065247444305083','77607616365134047716321522575586402645','48547165676922678774064078752350880746','67198712627349434045031324550499009240','49709559702814492775889109799450321031','9914110497602670113144133416648428842','83604390444852833451565395366418076022','7483637508160831271885082995872904566','15037434585035472426945879257409993146','57034211586404082506444266617893510727','54209365200234160165715396841773790508','49484900796589613202550579514364454982','66856381890558440482983467676253311780','61434157887788552886612191897422924510','75231578547780715406963704154631882065','3962497624617006635471803158383476275','3585153744460687838972312723395104097','77261384155289106941319321199015791420','75729109187487638214856253137936200198','86814260358408439441040282260818134268','14819940496141618191017795871669749056','72775906818119138287444112683020200453','64647711500825719064320557024676930395','28047611492837046407186871992245950347','35097847173525488564034493538405593424','80322102389030225333789296468097323148','32407102590898203716917548345867173829','66872684932424549464304440662753973758','725040409513917702770500025368448722','8750995912504437902724708592277497765','90421844594153103782399009441703922310','88948978504870080905068154030154273053','26636907686822870737370861000235385793','37670131638162151289221102669956299022','70054840782895739143890978802475306959','32555202406869828597069391463883690827','15856072445625526583907980386448194040','24362200000372915125179175977736867560','84773390223730137703964155693068770885','87260561108609522702427458435362361522','68413565256909801912807365082224827671','62344679434595770451755908584766885020','9074736293510690429256016565173888094','48551453790027439458953947846750428989','84942339775391223309029710913591707515','29289526239623715024073569293965406917','70569467923474857272318323562781528398','63605620784471083005050838291597530497','16260322680290256291514917062326318236','67728695322851893095571578419862907715','35703762504028263158711135692525674107','167687233459062668225908409142879029','70074767063056208707988869462367792647','8927015556441659439461347793016024846','4498972424484626554010816540081427936','91677741077127590036413770062961466743','32904218673209461501654463258657021707','5331410300768887829591838017553754915','23893464396335160064289275258530235647','88099289660045195282690652156929182871','2085423876068767174524379407574233320','11958391752109098676904941101201339317','7015638983957172530583216434946376221','69988542013618533973725538091337226054','91943186586102227638611807618950922050','35158743752392878035107594802206372487','1805944533240406274033018896972220427','8136122508701770705482982324608132264','58494071262162983208390600796570043195','17687461322616356587153275660353829467','68337967658502088683082467903551301222','52971539401893948363756488321736408214','24300250566571949804233113702462635500','85848762743587105202779115042533981158','67450760689841876246778769776781365437','65117891061051378584374843615307020350','47864055689306322651431225058490838849','57928637446201257798202428066661205495','67256730305331872134694692277556156103','23568035035409021638087432732891814457','59041896880742246641893871654046440270','40579512806418852433014749359237961140','91984191448880122428383027790882707308','74399686859487972221355179032539886824','296917033856590061609287372307774037','25635441086458536162512189965455814529','46523399339328314332143120404391785525','15426473967706690211581192682618400069','48824456466929672007005995863319553259','70854128711634825826844800361816291766','73857425659831195121290687678760587757','1226426788886744347275969479316472974','43740308280533094433840206802516189014','11128029146211569021529016564699827897','27439090872204609185509628925535423583','825257213026235748093327848291357539','24584709119214773674745997321333958573','44936907222899946238796315769568120268','6004240827708816503994682586178457878','50828281826130720207114784568424169696','13853398603295944144319719567879212022','4478221024658324726839060462164726861','76746358195564594467045380631523883536','8655402031416163252248559440016570771','78215935422327138687221417733532390439','61664900465368632027879578651092408616','31413555966769285276917556539591010328','83793827712006787798499664771513756842','83793949169314493977629046793318658361','16423470459521110407075466160008040662','78583595935683385322978834920906161725','35003567514569708061844869909247105107','7606179172074813677977734516405520671','33224628356214607651911711542900109764','10384402564947251098279113367076033584','947888036323971166267185506743896558','678449993910820043897741435620144918','60810002270509820391508412374456717985','1647070155598182836871759193377805340','8126656079668429958763988990757558234','43429219459568343684674804445421149711','2500890968031152347651458704030427644','18556593056868317585898192319270588577','85183887642657988852781883577541968314','64109328010232462133049295407111924656','18783798342163269995124995504990221699','84759348319811936612529243479946163680','15011643533549388341321878554383411808','34232432890758683366842306363428892960','60827981363428741275776477172357012233','20822592802474072842391370039436343376','4873912376493140442687939392024697151','37117352839893139156464328901605829478','7333030067391580921588265226521828137','87354619141266381964555128966303573419','43143799222981147204021610605624285953','66432726083420305402438883087419799266','38105947304129510336554421630575086026','4930391184310905308132479727707378708','88094823304449641451600645785081445658','14644307087898981752565896903895882379','78705401801680636853163896199707972354','5146909035161742318424845081249869320','8223111433465097338653320007155552091','91741079646438077462738378264396978626','33350649976876443123107720524540391154','73843146545343117384104365968065396864','8880222914748663980404486323520330282','75788936434445222351890174166908485337','72379098457625239116861642964501494598','71717155862234441675643406746382330296','49941520620739878546556006184149907541','43692253092232270041553241352967051242','11965950656273682843746465829338471932','37247520187150349696041260322015544466','58398233671302053523390958653838492254','541767154206069552443166899118997514','624300204149852984499584958948965454','15865993220346583852584573509484911748','714476597438780763244133392150686085','11942650214563759356638790163771889084','21037002813888457192946170081413681290','88095788710960616343517559958932445834','771818413166815592483753207785830340','34865922325947040901810752117999337949','32406699357910494306917530612484014903','15810272773848945356650842726843829049','46490505083568210108949340161043264213','50386184829870589378821037651495740609','56819374973518096506779282913139678670','85031036274235647695509849077859371969','76343739601299289827707881031691223630','20429448903580353166408827924195695452','51380280548068535388447702019540666578','67745584454747943986380272832479843783','48887024724763405916899620255394329067','16794256662922206407893467599572319887','6839351113035071017928650051964609865','449781186384218723126448545156061710','84257127973003841527622908603853098894','88638218816256835608358234454126450142','11931001753283600005463890638867076458','11577649302301243034119575066304509047','59468881261469105252475397300248240804','82159616534637003677846371869988089818','45431713463593616023218339515747168380','7145560704176368637420246472259927754','37759531593299379443245204738722268486','56042777881672959284990355241064667156','999184621799051042325601725752822863','82224985375869595363379525848636181350','74958615331134930066353745251426274301','46431704394808597523756863437621665857','10651997474098568983549504150666090554','63502854910861842109059557402438307017','14543909626983363864330173465107555598','85630433062487007416588269834706914505','85896696047443252507749358890905268714','91024420364950432868808607591520873031','2281080928893495337515858201758044568','71160313457348864101016494021782371342','25777415254857631595697605707623167202','545154019684129418243847993453284423','73780913554635636936191882751675860803','2078396751646508718761824266916793128','4611988598395501783842408888242905988','6548828634520415051357793759451504260','64703001716703765161922429505368711794','41018876850287758541435315343688732540','65779037769425149984127397528657577585','83235824738731886501028783517558196971','55216243292847524861236003994269685082','69860627997934463119068298674727350489','82034695060875863515112998323844661429','74628745266101947018472340388453695422','67877314891051418224269861788330546363','12917606846772454507255726401039190818','45301178658964992811077694686543722224','14813836405838268161195934197392859711','73643980890225807762086511827642905026','50800884978228275826513891122432653074','51897004856648664531263678912142137382','595996709666518323984676697824478876','12160668540070109517942398767741239784','64611483387579662834802441713316445966','55708683626893773715544891665877446873','58649356505826862815921436584798487020','71164299838361550421550470851578553040','3661431064265716081541664555251442491','47963886724183657027278914257591577915','64817519000653971433259522282549164337','73628554951885625444419457889449122962','77006303343496857242515774695818577870','15007758825875318651009526531806218501','85761976771930231104798908746200978122','60918612735390143494039928265544376607','39292104635969282617596560532655795939','79073260005471893674064666598107178360','17135214973748270436527053552385050269','3238080831622201846891326048298626556','57764528710462632284182659599600308550','90489180192475315733416993048587438061','2160632651695433892208670302236423082','67246523721747190861811618237394683409','23871314310776559277493355048161598112','32049714135797598953404441686444114230','25869179385851424412131557036843546100','8883032976420693976621319636554996496','83512329609034253848553534018925668695','79225200393809523947591707868313908733','11526400008671129648630725700052257363','1638563398635950139015743019693255666','36303542643191302247336203437677020174','80021618116700699277055891440465367479','5332280273767613207878197164609310203','40706495217846884038945701500243978432','57351789732557622777141260846891059021','13010485623300668226143434480375296736','68305783723408424697191011353093107934','10458628309049949456939755598140402982','32359183097941075075346682493545372988','33557240120717582088585079230963243411','87772552527998106392093621633626609865','49711188501787291683285044556440651309','4269035705458906648312535918939706217','30882136431787250692117602198543452665','30611120584287676812247483022481819606','6832068185224463583678014917489117466')
and post_cust_hit_time_gmt >='2017-10-26 00:00:00' and post_cust_hit_time_gmt<'2017-10-27 00:00:00'



select * from mendeley.aa_datafeed_mendeley limit 10

--------'21321234'

----find profile id's registered on profile and not in data
select web_user_id
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and uu_profile_id not in (with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
b.profile_id

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	
)




----oh god oh god this is painful

--so I needed all those visitor ID's that we can't explain the reg of those who are in profile table as reg but not in Aa data as reg and there activity in 
--redshift AA data to see wht paths they took if matching worked to rule out import join issue

select a.* from 

(select a.*, case when user_id_entitling_p12 like '%md:%' then substring(user_id_entitling_p12,4,100) else user_id_entitling_p12 end as profile_id from mendeley.aa_datafeed_mendeley a where post_cust_hit_time_gmt >='2017-10-26 00:00:00' and post_cust_hit_time_gmt<'2017-10-27 00:00:00'
) a
inner join (select uu_profile_id
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and uu_profile_id not in (with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
b.profile_id

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	
)

) b

on a.profile_id=b.uu_profile_id

---can't get web user ID formats to work properly --web user id sometimes has a profile ID in it
select * from mendeley.aa_datafeed_mendeley
where web_user_id in (select web_user_id
from mendeley.profiles
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and uu_profile_id not in (with decode as (
select distinct visitor_id, 
case when user_entitling_id_p12_prop12 like '%md:%' then substring(user_entitling_id_p12_prop12,4,100) else user_entitling_id_p12_prop12 end as profile_id
from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
order by 2,1
)

select 
b.profile_id

from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 a
left join decode b
on a.visitor_id=b.visitor_id
left join mendeley.profiles c
on b.profile_id=c.uu_profile_id
left join (select city as city_correct, profile_id from mendeley.profile_cities) d
on b.profile_id=d.profile_id
where joined >='2017-10-26 05:00:00' and joined<'2017-10-27 05:00:00'
and date='October 26, 2017'
and registrations_e2_event2>=1	
))
and web_user_id<>0
and web_user_id is not null
and web_user_id not in ('')

select distinct web_user_id from mendeley.aa_datafeed_mendeley order by 1 limit 1000

select * from mendeley.sh_temp_Acquisition_driver_tree_POC_2017_10_25__2017_10_31 limit 10

select * from mendeley.aa_datafeed_mendeley limit 10


referring_domains, 

user_access_type_v33, 